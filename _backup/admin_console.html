<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionGuard Admin Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #0f0;
            outline: none;
            width: 100%;
        }

        .btn-action {
            border: 1px solid #0f0;
            padding: 5px 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-action:hover {
            background: #0f0;
            color: #000;
        }

        .hidden-panel {
            display: none;
        }
    </style>
</head>

<body class="p-8 max-w-2xl mx-auto">
    <!-- Auth -->
    <div id="lock-screen" class="space-y-4 pt-20">
        <h1 class="text-2xl font-bold mb-4">ACCESS CONTROL</h1>
        <div class="flex items-center border-b border-green-900 pb-2">
            <span class="mr-2">></span>
            <input type="password" id="access-code" class="terminal-input" placeholder="ACCESS CODE"
                onkeyup="checkCode(event)">
            <button onclick="validateAuth()" class="ml-2 text-xs border border-green-900 px-2 text-green-700">[ ENTER
                ]</button>
        </div>
        <p id="auth-msg" class="text-red-500 text-sm hidden">ACCESS DENIED</p>
    </div>

    <!-- Panel -->
    <div id="admin-panel" class="hidden-panel space-y-8">
        <div class="border-b border-green-800 pb-4">
            <h1 class="text-xl font-bold">SYSTEM_ADMIN_CONSOLE v1.0</h1>
            <p class="text-xs text-green-600">STATE: ONLINE | DB: CONNECTED</p>
        </div>

        <div class="space-y-2">
            <label class="text-xs text-green-700">TARGET USER UUID</label>
            <input type="text" id="target-uuid"
                class="w-full bg-zinc-900 border border-green-800 p-3 text-white outline-none focus:border-green-500"
                placeholder="Paste ID here...">
            <button onclick="fetchUserProfile()" class="text-xs underline text-gray-500 hover:text-green-500">CHECK /
                INIT USER</button>
        </div>

        <div id="user-info-display" class="border border-green-900 p-4 bg-green-900/10 hidden">
            <p>CREDITS: <span id="current-credits">--</span></p>
            <p>PRO STATUS: <span id="current-pro">--</span></p>
            <p>EXPIRY: <span id="current-expiry">--</span></p>
        </div>

        <div class="grid grid-cols-2 gap-4 pt-4">
            <!-- Membership Section -->
            <div class="space-y-2">
                <h3 class="font-bold border-b border-green-900/50 pb-1">MEMBERSHIP</h3>
                <button onclick="activatePro(365)" class="btn-action w-full text-left">> ADD 1 YEAR</button>
                <button onclick="activatePro(30)" class="btn-action w-full text-left">> ADD 1 MONTH</button>
                <button onclick="activatePro(7)" class="btn-action w-full text-left">> ADD 7 DAYS</button>

                <!-- Custom Days -->
                <div class="flex gap-2 mt-2 pt-2 border-t border-green-900/30">
                    <input type="number" id="custom-days"
                        class="bg-zinc-900 border border-green-800 text-white w-20 px-2 text-xs" placeholder="DAYS">
                    <button onclick="activateCustomPro()" class="btn-action flex-1 text-xs text-center">SET
                        CUSTOM</button>
                </div>

                <button onclick="activatePro(-1)"
                    class="btn-action w-full text-left text-red-500 border-red-900 hover:bg-red-900 hover:text-white mt-4">>
                    REVOKE (CANCEL)</button>
            </div>

            <!-- Credits Section -->
            <div class="space-y-2">
                <h3 class="font-bold border-b border-green-900/50 pb-1">CREDITS</h3>
                <button onclick="addCredits(100)" class="btn-action w-full text-left">> +100 CREDITS</button>
                <button onclick="addCredits(1000)" class="btn-action w-full text-left">> +1000 CREDITS</button>
                <button onclick="addCredits(5000)" class="btn-action w-full text-left">> +5000 CREDITS</button>

                <!-- Custom Credits -->
                <div class="flex gap-2 mt-2 pt-2 border-t border-green-900/30">
                    <input type="number" id="custom-credits"
                        class="bg-zinc-900 border border-green-800 text-white w-20 px-2 text-xs" placeholder="AMT">
                    <button onclick="addCustomCredits()" class="btn-action flex-1 text-xs text-center">ADD
                        CUSTOM</button>
                </div>
            </div>
        </div>

        <div class="mt-8">
            <h3 class="text-xs text-green-700 mb-2">LOGS</h3>
            <div id="console-logs"
                class="text-xs font-mono text-gray-400 h-40 overflow-y-auto border-t border-green-900 pt-2 space-y-1">
                <p>> WAITING...</p>
            </div>
        </div>
    </div>

    <script>
        const ACCESS_CODE = 'vip888';
        function checkCode(e) { if (e.key === 'Enter') validateAuth(); }
        function validateAuth() {
            const val = document.getElementById('access-code').value;
            if (val === ACCESS_CODE) {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                initSupabase();
            } else {
                document.getElementById('auth-msg').style.display = 'block';
            }
        }
        function log(msg) {
            const div = document.getElementById('console-logs');
            const p = document.createElement('p');
            p.innerText = `> ${new Date().toLocaleTimeString()} ${msg}`;
            div.prepend(p);
        }

        // --- Custom Inputs Wrappers ---
        function activateCustomPro() {
            const val = document.getElementById('custom-days').value;
            const d = parseInt(val);
            if (d > 0) activatePro(d);
            else log(`INVALID DAYS: '${val}' parsed as ${d}`);
        }
        function addCustomCredits() {
            const val = document.getElementById('custom-credits').value;
            const c = parseInt(val);
            if (c !== 0 && !isNaN(c)) addCredits(c);
            else log(`INVALID AMOUNT: '${val}' parsed as ${c}`);
        }
    </script>

    <script>
        let supabase = null;
        function initSupabase() {
            const SUPABASE_URL = 'https://oqwqlrmqblguiikrsmjf.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xd3Fscm1xYmxndWlpa3JzbWpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMzcwMDUsImV4cCI6MjA4MzcxMzAwNX0.JlVesN-orDXZa5skq_WmKcVTpLP_HKMq2GKWwfuMoTA';
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            log("SYSTEM ONLINE.");
        }

        async function ensureUserProfile(userId) {
            const { data } = await supabase.from('profiles').select('*').eq('id', userId).maybeSingle();
            if (data) return data;

            log(`NEW ID DETECTED. CREATING PROFILE...`);
            const { data: newData, error } = await supabase
                .from('profiles')
                .insert([{ id: userId, credits: 0, is_pro: false }])
                .select()
                .single();

            if (error) { log(`CREATE ERROR: ${error.message}`); return null; }
            return newData;
        }

        async function fetchUserProfile() {
            const userId = document.getElementById('target-uuid').value.trim();
            if (!supabase || !userId) return;

            log("FETCHING...");
            const profile = await ensureUserProfile(userId);
            if (!profile) return;

            document.getElementById('user-info-display').classList.remove('hidden');
            document.getElementById('current-credits').innerText = profile.credits;
            document.getElementById('current-pro').innerText = profile.is_pro ? "YES" : "NO";
            document.getElementById('current-expiry').innerText = profile.subscription_end_date ? new Date(profile.subscription_end_date).toLocaleDateString() : "N/A";
            log("DATA LOADED.");
        }

        async function activatePro(days) {
            const userId = document.getElementById('target-uuid').value.trim();
            if (!supabase || !userId) return;

            const profile = await ensureUserProfile(userId);
            if (!profile) return;

            let endDate = null, isPro = false;
            if (days !== -1) {
                const date = new Date();
                date.setDate(date.getDate() + days);
                endDate = date.toISOString();
                isPro = true;
            }

            const { error } = await supabase.from('profiles').update({ is_pro: isPro, subscription_end_date: endDate }).eq('id', userId);
            if (error) log(`ERROR: ${error.message}`);
            else { log("SUCCESS: MEMBER UPDATED"); fetchUserProfile(); }
        }

        async function addCredits(amt) {
            const userId = document.getElementById('target-uuid').value.trim();
            if (!supabase || !userId) return;

            const profile = await ensureUserProfile(userId);
            if (!profile) return;

            const newCredits = (profile.credits || 0) + amt;
            const { error } = await supabase.from('profiles').update({ credits: newCredits }).eq('id', userId);

            if (error) log(`ERROR: ${error.message}`);
            else { log(`SUCCESS: CREDITS = ${newCredits}`); fetchUserProfile(); }
        }
    </script>
</body>

</html>